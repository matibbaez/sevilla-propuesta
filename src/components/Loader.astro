---
// src/components/Loader.astro
---

<div id="initial-loader" class="fixed inset-0 z-[100] bg-[#0f172a] flex flex-col items-center justify-center transition-opacity duration-500 overflow-hidden">
  
  <div class="relative flex flex-col items-center">
    
    <div id="bike-container" class="relative z-10 origin-bottom-right">
      
      <div class="absolute bottom-2 -left-10 w-20 h-10 bg-white/5 blur-xl rounded-full opacity-0 animate-pulse" id="exhaust-smoke"></div>

      <svg id="bike-svg" class="w-32 h-32 text-accent animate-idle" fill="currentColor" viewBox="0 0 24 24">
        <circle cx="5" cy="15" r="3" class="opacity-80" />
        <circle cx="19" cy="15" r="3" class="opacity-80" />
        <path d="M5 15 L9 15 L11 10 L17 10 L19 15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M11 10 L9 7 L6 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M17 10 L15 6 L12 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M9 7 Q12 5 15 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        <path d="M15 6 L16 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg>

    </div>

    <div id="loader-ui" class="mt-8 flex flex-col items-center transition-all duration-300">
      
      <div class="text-4xl font-serif-logo font-bold text-white mb-2 tabular-nums tracking-widest">
        <span id="counter">0</span><span class="text-accent text-lg align-top">%</span>
      </div>

      <div class="w-64 h-[2px] bg-white/10 rounded-full overflow-hidden relative">
        <div id="loader-bar" class="absolute top-0 left-0 h-full bg-accent w-0 shadow-[0_0_15px_#C5A059]"></div>
      </div>

      <div class="mt-3 text-white/30 text-[10px] font-title tracking-[0.4em] uppercase">
        Estudio Sevilla Abogados
      </div>
    </div>

  </div>

</div>

<style>
  /* 1. Animación de "Ralentí" (La moto vibrando suave) */
  @keyframes idle {
    0% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-1px) rotate(-0.5deg); }
    50% { transform: translateY(0px) rotate(0deg); }
    75% { transform: translateY(-1px) rotate(0.5deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }
  .animate-idle {
    animation: idle 0.1s infinite linear; /* Vibración rápida */
  }

  /* 2. Animación de "Vibración Fuerte" (Al cargar) */
  .animate-rev {
    animation: idle 0.05s infinite linear; /* Vibración MUY rápida */
  }

  /* 3. Animación de SALIDA (Wheelie y Zoom) */
  @keyframes wheelie-out {
    0% { transform: translateX(0) rotate(0); }
    30% { transform: translateX(-20px) rotate(-25deg); } /* Se levanta (Wheelie) y toma impulso atrás */
    100% { transform: translateX(150vw) rotate(-20deg); } /* Sale disparada a la derecha */
  }
  .bike-launch {
    animation: wheelie-out 0.8s cubic-bezier(0.5, 0, 0.2, 1) forwards;
  }
</style>

<script>
  const loader = document.getElementById('initial-loader');
  const bar = document.getElementById('loader-bar');
  const counter = document.getElementById('counter');
  const bikeSvg = document.getElementById('bike-svg');
  const bikeContainer = document.getElementById('bike-container');
  const loaderUI = document.getElementById('loader-ui');
  const exhaust = document.getElementById('exhaust-smoke');

  window.addEventListener('load', () => {
    
    // 1. Fase de Carga (Simulada)
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.floor(Math.random() * 5) + 2; // Incrementos aleatorios para realismo
      
      if (progress > 100) progress = 100;
      
      // Actualizar UI
      if (bar) bar.style.width = `${progress}%`;
      if (counter) counter.innerText = progress;

      // Efecto: A mayor carga, más vibra la moto ("Al corte")
      if (progress > 50 && bikeSvg) {
        bikeSvg.classList.remove('animate-idle');
        bikeSvg.classList.add('animate-rev'); // Vibración más fuerte
        if(exhaust) exhaust.classList.remove('opacity-0'); // Sale humo
      }

      // 2. Finalizar Carga
      if (progress === 100) {
        clearInterval(interval);
        launchBike();
      }
    }, 30); // Velocidad de carga

    function launchBike() {
      // Ocultar barra y texto suavemente
      if (loaderUI) {
        loaderUI.style.opacity = '0';
        loaderUI.style.transform = 'translateY(20px)';
      }

      // ANIMACIÓN DE SALIDA (WHEELIE)
      setTimeout(() => {
        if (bikeContainer) {
          bikeContainer.classList.add('bike-launch');
        }
      }, 200);

      // DESVANECER PANTALLA NEGRA
      setTimeout(() => {
        if (loader) loader.classList.add('opacity-0');
        document.body.style.overflow = ''; // Habilitar scroll del sitio
      }, 800); // Esperamos a que la moto salga casi toda

      // LIMPIEZA DOM
      setTimeout(() => {
        if (loader) loader.remove();
      }, 1500);
    }
  });
</script>